
<!DOCTYPE html>
<html>
  <head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    
    <script async src="https://cse.google.com/cse.js?cx=315531be7c52f5156"></script>
    <title>
      
        Tratteria
      
    </title>
    <link rel="stylesheet" href="/css/style.1df9f62415d297f5c54d2fc02d71b1b122e108253802ae8fa49b752f0120f199.css" integrity="sha256-Hfn2JBXSl/XFTS/ALXGxsSLhCCU4Aq6PpJt1LwEg8Zk=">

    


<link rel="shortcut icon" href="/favicon.svg">


    
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
<script src="/js/app.09103495742f46957c0ccfe21325d1eb09374faea4d172abd0531e9d9fe6ea17.js" type="module" integrity="sha256-CRA0lXQvRpV8DM/iEyXR6wk3T66k0XKr0FMenZ/m6hc="></script>


  </head>

    <body>
      






<div class="navbar navbar-expand-lg navbar-light bg-light sticky-top" role="navigation" aria-label="main navigation">
  <div class="container nav-container">
    <div class="navbar-brand">
      <a class="navbar-item text-hide" href="https://tratteria.io/">
        Tratteria
        
        
          <img src="/img/logos/text-image-logo.svg" class="logo">
        
      </a>
    </div>

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main-nav" aria-controls="main-nav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="main-nav">
      <ul class="navbar-nav mr-auto">
        
        
        
        <li class="navbar-start navbar-item">
          
          <a class="nav-link" href="/">
            Home
          </a>
          
        
        <li class="navbar-start navbar-item is-active">
          
          <a class="nav-link" href="/docs/">
            Documentation
          </a>
          
        </li>
        
      </ul>
      <div class="gcse-search"></div>
    </div>
  </div> 
</div>

    <main class="content">
      
  <header>
    <div>
      <div class="container mt-4 mb-4 pb-2">
  <section class="row">
      
  </section>
</section>
</div>

    </div>
  </header>
  <div class="container">
      <section class="row">
        <section class="col">
           
 
 




<nav class="section-nav">
      <p class="menu-label open" id="leftnavToggle">Documentation:</p>      
      <ul class="menu-list" id="leftnav">
        <li><a  class="active"  href="/docs/">Introduction to Tratteria</a>
        
        </li>
    
        <li><a  class="active"  href="/docs/quickstart/">Quickstart Guide</a>
          <ul>
            
          </ul>
        </li>
    
        <li><a  class="active"  href="/docs/installation/">Installing Tratteria</a>
          <ul>
            
            <li>
                <a  class="active"  href="/docs/installation/installing-tconfigd/">Installing Tconfigd</a>
            </li>
            
            <li>
                <a  class="active"  href="/docs/installation/deploying-tratteria/">Deploying Tratteria Service</a>
            </li>
            
            <li>
                <a  class="active"  href="/docs/installation/setting-up-tratteria-agents/">Setting Up Tratteria Agents</a>
            </li>
            
          </ul>
        </li>
    
        <li><a  class="active"  href="/docs/generating-and-verifying-trats/">Generating and Verifying TraTs</a>
          <ul>
            
          </ul>
        </li>
    
        <li><a  class="active"  href="/docs/configuration-guide/">Configuration Guide</a>
          <ul>
            
            <li>
                <a  class="active"  href="/docs/configuration-guide/trat/">TraT</a>
            </li>
            
            <li>
                <a  class="active"  href="/docs/configuration-guide/trat-exclusion/">TraTExclusion</a>
            </li>
            
            <li>
                <a  class="active"  href="/docs/configuration-guide/tratteria-config/">TratteriaConfig</a>
            </li>
            
            <li>
                <a  class="active"  href="/docs/configuration-guide/example-application-configs/">Example Application Configurations</a>
            </li>
            
          </ul>
        </li>
    
        <li><a  class="active"  href="/docs/transaction-token/">Transaction Tokens (TraTs)</a>
          <ul>
            
          </ul>
        </li>
    

</nav>

        </section>
        <section class="col col-8">
          <h1 class="title">Introduction to Tratteria</h1>
          <p class="subtitle"></p>
          
<div class="content">
  <style>
.doc-image {
    display: block;
    margin: 50px;
    padding: 0;
}
</style>
<p>Welcome to the documentation for Tratteria, an open-source <a href="https://datatracker.ietf.org/doc/draft-ietf-oauth-transaction-tokens/" target="_blank" rel="noopener">Transaction Tokens</a> (TraTs) Service. This guide will help you understand what Tratteria is, how it works, and how to implement it in your microservices architecture.</p>
<h2 id="trat">
  TraT
  <a href="#trat">
    <span class="icon hashlink">
      <i class="fas fa-link"></i>
    </span>
  </a>
</h2>
<p>TraTs (Transaction Tokens) are short-lived JWTs that assure identity and context in a microservices call chain. Learn more about TraTs <a href="/docs/transaction-token">here</a>. The example below describes the salient features of a TraT:</p>
<!-- Image -->
<p><img src="/img/docs/introduction/what_is_a_trat.svg" 
alt="What Is a TraT" 
class="doc-image" 
style="cursor: pointer;" 
onclick="openModal();"></p>
<!-- Modal Structure -->
<div id="imageModal" class="modal">
  <span class="close" onclick="closeModal()">&times;</span>
  <img class="modal-content" id="popupImage">
</div>
<!-- Styles for Modal -->
<style>
.modal {
  display: none; 
  position: fixed; 
  z-index: 1000; 
  left: 0;
  top: 0;
  width: 100%;
  height: 100%; 
  background-color: rgba(0, 0, 0, 0.8); 
  justify-content: center;
  align-items: center;
}

.modal-content {
  max-width: 90%;
  max-height: 90%;
  margin: auto;
  display: block;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
  border-radius: 8px;
}

.close {
  position: absolute;
  top: 15px;
  right: 35px;
  color: #fff;
  font-size: 40px;
  font-weight: bold;
  cursor: pointer;
}

.close:hover,
.close:focus {
  color: #bbb;
  text-decoration: none;
  cursor: pointer;
}

</style>
<!-- JavaScript for Modal -->
<script>
function openModal() {
  const modal = document.getElementById('imageModal');
  modal.style.display = 'flex';
  document.getElementById('popupImage').src = '/img/docs/introduction/what_is_a_trat.svg';
  
  // Close when Esc key is pressed
  document.onkeydown = function(event) {
    if (event.key === "Escape") {
      closeModal();
    }
  };

  // Close when clicking outside the image
  modal.onclick = function(event) {
    if (event.target === modal) {
      closeModal();
    }
  };
}

function closeModal() {
  document.getElementById('imageModal').style.display = 'none';
  document.onkeydown = null; // Remove the event listener when the modal is closed
}
</script>
<h2 id="tratteria-architecture">
  Tratteria Architecture
  <a href="#tratteria-architecture">
    <span class="icon hashlink">
      <i class="fas fa-link"></i>
    </span>
  </a>
</h2>
<p>Tratteria is designed to facilitate secure and convenient TraT issuance and verification in microservices systems. It involves the Tratteria Service for issuing TraTs, the Tratteria Agent sidecar for verifying TraTs, and Tratteria Kubernetes resources for specifying generation and verification rules for TraTs.</p>
<img src="/img/docs/introduction/tratteria_workflow.svg" alt="Tratteria Workflow" class="doc-image">
<br>
<h2 id="tratteria-modes">
  Tratteria Modes
  <a href="#tratteria-modes">
    <span class="icon hashlink">
      <i class="fas fa-link"></i>
    </span>
  </a>
</h2>
<p>Tratteria can operate in two modes:</p>
<ul>
<li>
<p><strong>The Interception Mode</strong>: Enables existing applications to adopt TraTs without (almost) any code changes. It injects Tratteria Agent sidecar containers into Kubernetes pods, and the application continues to operate the way it used to, except the path, query and body of each call are verified against an associated TraT.</p>
<p>If a service needs to forward a TraT to a downstream service, then it needs to add the <code>Txn-token</code> HTTP header and include the TraT as the value of that header in outbound calls. If a microservice does not make any downstream calls, then it does not need to change.</p>
</li>
<li>
<p><strong>The Delegation Mode</strong>: In this approach, the application explicitly calls the Tratteria Agent within its Kubernetes pod to verify TraTs. As a result, the application needs to make this change to its code to use Tratteria. This mode is more secure than the interception mode, as it avoids scenarios where sidecar could potentially be bypassed. In addition, a delegation based approach allows the application to pack the call parameter information in the Txn-Token header, and can potentially eliminate having to send it separately through query parameters or the body.</p>
<p>This mode is suitable for environments where intercepting incoming requests is not possible or desired, for example, in environments with a service mesh that is already intercepting incoming requests.</p>
</li>
</ul>
<h2 id="tratteria-resource">
  Tratteria Resource
  <a href="#tratteria-resource">
    <span class="icon hashlink">
      <i class="fas fa-link"></i>
    </span>
  </a>
</h2>
<p>Tratteria lets you define how to generate the TraT for an external API and how to verify the TraT for the resulting internal requests of the external API using Kubernetes resources. Additionally, it supports specifying access evaluation for external APIs.</p>
<p>Below is a sample Tratteria Kubernetes resource for the <code>POST api/order/trade/{#stockId}</code> external API. Hover your mouse over the text below to find out more about what each line means:</p>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
.tooltip {
    position: relative;
    display: inline;
    cursor: help;
}
.tooltip .tooltiptext {
    visibility: hidden;
    min-width: 400px;
    max-width: 600px;
    background-color: #555;
    color: #fff;
    text-align: center;
    border-radius: 6px;
    padding: 5px 10px;
    position: absolute;
    z-index: 100;
    left: 0;
    top: 0px;
    transform: translateY(-100%);
    opacity: 0;
    transition: opacity 0.5s, visibility 0.5s;
    white-space: normal;
    word-wrap: break-word;
}
pre {
    background-color: #1e1e1e;
    border: none;
    color: #d4d4d4;
    font-family: 'Courier New', monospace;
    font-size: 15px;
    line-height: 1.5;
    overflow: auto;
    padding: 10px;
    border-radius: 5px;
    width: auto;
    display: block; 
}
.yaml-key {
    color: #f92672;
}
.yaml-value {
    color: #ae81ff;
}
.yaml-string {
    color: #e6db74;
}
</style>
</head>
<body>
<pre>
<code class="yaml"><span class="yaml-key">apiVersion</span>: <span class="yaml-value">tratteria.io/v1alpha1</span>
<span class="yaml-key">kind</span>: <span class="yaml-value">TraT</span>
<span class="yaml-key">metadata</span>:
  <span class="tooltip"><span class="yaml-key">name</span>: <span class="yaml-value">trade-api-trat</span><span class="tooltiptext">The name of the TraT used for this external API. This uniquely identifies the TraT type within the Tratteria system.</span></span>
  <span class="yaml-key">namespace</span>: <span class="yaml-value">app-dev</span>
<span class="yaml-key">spec</span>:
  <span class="tooltip"><span class="yaml-key">path</span>: <span class="yaml-value">"api/order/trade/{#stockId}?action={#action}"</span><span class="tooltiptext">The default URL path, which, together with the method field below, results in this type of TraT being generated or validated. The URL may used by external API services or internal microservices.</span></span>
  <span class="tooltip"><span class="yaml-key">method</span>: <span class="yaml-value">"POST"</span><span class="tooltiptext">The HTTP method for which this TraT resource is defined (see `path` above).</span></span>
  <span class="tooltip"><span class="yaml-key">purp</span>: <span class="yaml-value">"stock-trade"</span><span class="tooltiptext">The purpose of the TraT, which is included in the `purp` field of TraTs of this type.</span></span>
  <span class="tooltip"><span class="yaml-key">azdMapping</span>:
    <span class="yaml-key">stockId</span>:
      <span class="yaml-key">required</span>: <span class="yaml-value">true</span>
      <span class="yaml-key">value</span>: <span class="yaml-string">"${stockId}"</span>
    <span class="yaml-key">action</span>:
      <span class="yaml-key">required</span>: <span class="yaml-value">true</span>
      <span class="yaml-key">value</span>: <span class="yaml-string">"${action}"</span>
    <span class="yaml-key">quantity</span>:
      <span class="yaml-key">required</span>: <span class="yaml-value">true</span>
      <span class="yaml-key">value</span>: <span class="yaml-string">"${body.quantity}"</span><span class="tooltiptext">The immutable context preserved in this TraT and how to construct and verify it.</span></span>
  <span class="tooltip"><span class="yaml-key">services</span>:
    - <span class="yaml-key">name</span>: <span class="yaml-value">order</span>
    - <span class="yaml-key">name</span>: <span class="yaml-value">catalog</span>
      <span class="tooltip"><span class="yaml-key">path</span>: <span class="yaml-string">"catalog/catalog-update/{#stockId}?update-type={#action}"</span><span class="tooltiptext">The catalog service overrides just the path.</span></span>
    - <span class="yaml-key">name</span>: <span class="yaml-value">stocks</span>
      <span class="tooltip"><span class="yaml-key">path</span>: <span class="yaml-string">"stocks/{#id}"</span><span class="tooltiptext">The stocks service overrides the path, method and how it receives information that needs to be verified against the TraT content.</span></span>
      <span class="tooltip"><span class="yaml-key">method</span>: <span class="yaml-string">"GET"</span><span class="tooltiptext">As noted above, the stocks service overrides defaults for the HTTP method.</span></span>
      <span class="tooltip"><span class="yaml-key">azdMapping</span>:
        <span class="yaml-key">stockId</span>:
          <span class="yaml-key">required</span>: <span class="yaml-value">true</span><span class="tooltiptext">As noted above, the stocks service overrides defaults for TraT verification</span></span>
          <span class="yaml-key">value</span>: <span class="yaml-string">"{$id}"</span><span class="tooltiptext">The list of microservice APIs that are invoked while processing this external API. They may use defaults specified above or override them.</span></span>
  <span class="tooltip"><span class="yaml-key">accessEvaluation</span>:
    <span class="yaml-key">subject</span>:
      <span class="yaml-key">id</span>: <span class="yaml-string">"${subject_token.email}"</span>
    <span class="yaml-key">action</span>:
      <span class="yaml-key">name</span>: <span class="yaml-string">"${body.orderType}"</span>
    <span class="yaml-key">resource</span>:
      <span class="yaml-key">stockId</span>: <span class="yaml-string">"${stockId}"</span><span class="tooltiptext">Tratteria can call out to an AuthZEN API to evaluate whether execution should proceed. This specifies how to construct the request for access evaluation.</span></span></code>
</pre>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const tooltips = document.querySelectorAll('.tooltip');
    
    function hideAllTooltips() {
        document.querySelectorAll('.tooltip .tooltiptext').forEach(tt => {
            tt.style.visibility = 'hidden';
            tt.style.opacity = '0';
        });
    }

    tooltips.forEach(tooltip => {
        tooltip.addEventListener('mouseover', function(e) {
            e.stopPropagation();

            hideAllTooltips();

            const tooltipText = Array.from(this.children).find(child => child.classList.contains('tooltiptext'));
            if (tooltipText) {
                tooltipText.style.visibility = 'visible';
                tooltipText.style.opacity = '1';
            }
        });

        tooltip.addEventListener('mouseout', function() {
            const tooltipText = Array.from(this.children).find(child => child.classList.contains('tooltiptext'));
            if (tooltipText) {
                tooltipText.style.visibility = 'hidden';
                tooltipText.style.opacity = '0';
            }
        });
    });
});

</script>
</body>
</html>
<p>The above specifies how to generate purpose and authorization details for the <code>POST api/order/trade/{#stockId}</code> API, and it specifies who (the <code>order</code>, <code>catalog</code>, and <code>stocks</code> services) and how to verify the generated TraT. Additionally, the <code>accessEvaluation</code> section specifies how to perform access evaluations for the API.</p>
<p>To quickly see Tratteria in action, checkout the <a href="/docs/quickstart">Quickstart Guide</a>.</p>
<p>To integrate Tratteria into your microservice application, start by <a href="/docs/installation">installing Tratteria</a>, which can be deployed in environments with or without a service mesh.</p>
<h2 id="acknowledgments">
  Acknowledgments
  <a href="#acknowledgments">
    <span class="icon hashlink">
      <i class="fas fa-link"></i>
    </span>
  </a>
</h2>
<p>This documentation and the underlying technology are based on the concepts and <a href="https://datatracker.ietf.org/doc/draft-ietf-oauth-transaction-tokens/" target="_blank" rel="noopener">draft</a> developed by Atul Tulshibagwale (SGNL), George Fletcher (Capital One), and Pieter Kasselman (Microsoft).</p>
<h2 id="contact-us">
  Contact Us
  <a href="#contact-us">
    <span class="icon hashlink">
      <i class="fas fa-link"></i>
    </span>
  </a>
</h2>
<p>For inquiries about Tratteria, please email us at: <a href="mailto:tratteria@sgnl.ai">tratteria@sgnl.ai</a></p>

</div>


        </section>
        <section class="col d-none d-lg-block">
          



  <div class="toc">
    <p> On this page:</p>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#trat">TraT</a></li>
    <li><a href="#tratteria-architecture">Tratteria Architecture</a></li>
    <li><a href="#tratteria-modes">Tratteria Modes</a></li>
    <li><a href="#tratteria-resource">Tratteria Resource</a></li>
    <li><a href="#acknowledgments">Acknowledgments</a></li>
    <li><a href="#contact-us">Contact Us</a></li>
  </ul>
</nav>
  </div>


        </section>
      </section>
    </div>

    </main>
    



<footer class="text-light bg-dark" style="padding: 20px 0; text-align: center;">
  <div class="footer">
    <p>Tratteria is an open-source project sponsored by <a href="https://www.sgnl.ai" target="_blank">SGNL.ai</a></p>
  </div>
  
  <div class="container">

    <div style="margin-bottom: 20px;">
      <i class="fab fa-github" style="font-size: 24px;"></i>
    </div>

    
    <div style="margin-bottom: 20px;">
      


<a class="btn text-light" style="background-color: #000000" href="https://github.com/tratteria">
    
    <span class="icon">
      <i class="fab fa-github"></i>
    </span>
    
    
      GitHub
    
  </a>


<a class="btn text-light" style="background-color: #555555" href="mailto:tratteria@sgnl.ai">
    
    <span class="icon">
      <i class="fas fa-paper-plane"></i>
    </span>
    
    
      Email
    
  </a>


    </div>
    

    <p style="margin-top: 20px;">
      &copy; 2024 SGNL.ai, Inc.
    </p>
  </div>
</footer>
  </body>
</html>
