
<!DOCTYPE html>
<html>
  <head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    
    <script async src="https://cse.google.com/cse.js?cx=315531be7c52f5156"></script>
    <title>
      
        Tratteria
      
    </title>
    <link rel="stylesheet" href="/css/style.1df9f62415d297f5c54d2fc02d71b1b122e108253802ae8fa49b752f0120f199.css" integrity="sha256-Hfn2JBXSl/XFTS/ALXGxsSLhCCU4Aq6PpJt1LwEg8Zk=">

    


<link rel="shortcut icon" href="/favicon.svg">


    
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
<script src="/js/app.09103495742f46957c0ccfe21325d1eb09374faea4d172abd0531e9d9fe6ea17.js" type="module" integrity="sha256-CRA0lXQvRpV8DM/iEyXR6wk3T66k0XKr0FMenZ/m6hc="></script>


  </head>

    <body>
      






<div class="navbar navbar-expand-lg navbar-light bg-light sticky-top" role="navigation" aria-label="main navigation">
  <div class="container nav-container">
    <div class="navbar-brand">
      <a class="navbar-item text-hide" href="https://tratteria.io/">
        Tratteria
        
        
          <img src="/img/logos/text-image-logo.svg" class="logo">
        
      </a>
    </div>

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main-nav" aria-controls="main-nav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="main-nav">
      <ul class="navbar-nav mr-auto">
        
        
        
        <li class="navbar-start navbar-item">
          
          <a class="nav-link" href="/">
            Home
          </a>
          
        
        <li class="navbar-start navbar-item">
          
          <a class="nav-link" href="/docs/">
            Documentation
          </a>
          
        </li>
        
      </ul>
      <div class="gcse-search"></div>
    </div>
  </div> 
</div>

    <main class="content">
      
  <header>
    <div>
      <div class="container mt-4 mb-4 pb-2">
  <section class="row">
      
          

<div class="col col-11 breadcrumb" aria-label="breadcrumbs">
  <ul class="mb-0 pt-2" style="vertical-align: middle">
    

  

  

  



<li >
  / <a href="/">
    Home
  </a>
</li>




<li >
  / <a href="/docs/">
    Introduction to Tratteria
  </a>
</li>




<li >
  / <a href="/docs/configuration-guide/">
    Configuration Guide
  </a>
</li>




<li  class="is-active">
  / <a href="/docs/configuration-guide/tratteria-config/">
    TratteriaConfig
  </a>
</li>

  </ul>
</div>

          <div>
    
    
    
    <a href="https://github.com/tratteria/website/blob/main/content/docs/configuration-guide/tratteria-config.md" class="btn btn-primary" target="_blank">
      <i class="fas fa-pen"></i>
    </a>
</div>

      
  </section>
</section>
</div>

    </div>
  </header>
  <div class="container">
      <section class="row">        
        <section class="col">
           
 
 




<nav class="section-nav">
      <p class="menu-label open" id="leftnavToggle">Documentation:</p>      
      <ul class="menu-list" id="leftnav">
        <li><a  href="/docs/">Introduction to Tratteria</a>
        
        </li>
    
        <li><a  href="/docs/quickstart/">Quickstart Guide</a>
          <ul>
            
          </ul>
        </li>
    
        <li><a  href="/docs/installation/">Installing Tratteria</a>
          <ul>
            
            <li>
                <a  href="/docs/installation/installing-tconfigd/">Installing Tconfigd</a>
            </li>
            
            <li>
                <a  href="/docs/installation/deploying-tratteria/">Deploying Tratteria Service</a>
            </li>
            
            <li>
                <a  href="/docs/installation/setting-up-tratteria-agents/">Setting Up Tratteria Agents</a>
            </li>
            
          </ul>
        </li>
    
        <li><a  href="/docs/generating-and-verifying-trats/">Generating and Verifying TraTs</a>
          <ul>
            
          </ul>
        </li>
    
        <li><a  href="/docs/configuration-guide/">Configuration Guide</a>
          <ul>
            
            <li>
                <a  href="/docs/configuration-guide/trat/">TraT</a>
            </li>
            
            <li>
                <a  href="/docs/configuration-guide/trat-exclusion/">TraTExclusion</a>
            </li>
            
            <li>
                <a  href="/docs/configuration-guide/tratteria-config/">TratteriaConfig</a>
            </li>
            
            <li>
                <a  href="/docs/configuration-guide/example-application-configs/">Example Application Configurations</a>
            </li>
            
          </ul>
        </li>
    
        <li><a  href="/docs/transaction-token/">Transaction Tokens (TraTs)</a>
          <ul>
            
          </ul>
        </li>
    

</nav>

        </section>
        <section class="col col-8">
          <h1 class="title">TratteriaConfig</h1>
          <p class="subtitle"></p>
          
<div class="content">
  <p>The TratteriaConfig resource defines general configuration settings that apply to all APIs and TraTs within a specified Kubernetes namespace.</p>
<p>Let&rsquo;s delve into the details of TraTs by examining an example.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">tratteria.io/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">TratteriaConfig</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">alpha-stocks-tratteriacfg</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">alpha-stocks-dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">token</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">issuer</span>: <span style="color:#e6db74">&#34;https://alphastocks.com/tratteria&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">audience</span>: <span style="color:#e6db74">&#34;https://alphastocks.com/&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">lifeTime</span>: <span style="color:#e6db74">&#34;15s&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">subjectTokens</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">OIDC</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">clientId</span>: <span style="color:#ae81ff">alpha-stocks-client</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">providerURL</span>: <span style="color:#ae81ff">http://dex:5556/dex</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">subjectField</span>: <span style="color:#ae81ff">email</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">selfSigned</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">validation</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">jwksEndpoint</span>: <span style="color:#e6db74">&#34;http://alphastocks.com/oidcprovider/.well-known/jwks.json&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">accessEvaluationAPI</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enableAccessEvaluation</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">endpoint</span>: <span style="color:#e6db74">&#34;https://alphastocks.authzen.com/access/v1/evaluation&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">authentication</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">method</span>: <span style="color:#e6db74">&#34;Bearer&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">token</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;${AUTHORIZATION_API_BEARER_TOKEN}&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">tokenGenerationAuthorizedServiceIds</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;spiffe://dev.alphastocks.com/gateway&#34;</span>
</span></span></code></pre></div><p>TratteriaConfig includes the following sections:</p>
<h5 id="token-required">
  token (Required)
  <a href="#token-required">
    <span class="icon hashlink">
      <i class="fas fa-link"></i>
    </span>
  </a>
</h5>
<p>Configures the TraTs and includes the following parameters:</p>
<ul>
<li>
<p><strong>issuer (Required)</strong>:
Represents the Tratteria server that issues TraTs, used as the <code>iss</code> claim in the generated TraTs.</p>
</li>
<li>
<p><strong>audience (Required)</strong>:
Represents the intended recipient of the TraTs, used as the <code>aud</code> claim in the generated TraTs.</p>
</li>
<li>
<p><strong>lifeTime (Required)</strong><br>
Defines the duration for which the generated TraTs are valid. The value chosen should align with your application&rsquo;s API response times, and should generally be in the order of seconds. Longer-lasting tokens are less secure. A good approach is to match the tokenâ€™s lifetime to the API timeout value. For instance, if APIs requests time out after 15 seconds, setting the token lifetime to 15 seconds is advisable. The token lifetime should not exceed your API timeout duration.</p>
</li>
</ul>
<h5 id="subjecttokens-required">
  subjectTokens (Required)
  <a href="#subjecttokens-required">
    <span class="icon hashlink">
      <i class="fas fa-link"></i>
    </span>
  </a>
</h5>
<p>Subject tokens are required for uniquely identifying the individual, entity, or user involved in a transaction. The TraT token request includes a subject token. Tratteria validates the subject token and determines the value to specify as the <code>sub</code> of the issued TraT. As of now, Tratteria supports OIDC ID tokens and self-signed JWTs as subject tokens. Configuration for at least one method should be provided.</p>
<ul>
<li>
<p><strong>OIDC (Optional):</strong><br>
OIDC ID tokens serve as a means to uniquely identify users within an OpenID Connect (OIDC) framework. When OIDC ID tokens are used in TraT token requests as subject tokens, the requester must set the <code>subject_token_type</code> to <code>urn:ietf:params:oauth:token-type:id_token</code>.</p>
<p>This configuration is optional. When configured, it includes the following:</p>
<ul>
<li>
<p><strong>clientId (Required)</strong><br>
The client application identifier within the OIDC framework.</p>
</li>
<li>
<p><strong>providerURL (Required)</strong><br>
The URL of the OIDC provider.</p>
</li>
<li>
<p><strong>subjectField (Required)</strong><br>
The claim or field of the OIDC ID token to be used as <code>sub</code> in the issued TraT.</p>
</li>
</ul>
<p><a href="https://github.com/tratteria/example-application" target="_blank" rel="noopener">Tratteria example application</a> utilizes OIDC ID tokens for subject tokens. Refer to it for guidance on configuration and its usage as the subject token in the TraT request.</p>
</li>
<li>
<p><strong>selfSigned (Optional):</strong><br>
Self-signed JWTs can also be used as subject tokens. In this case, the requester must set the <code>subject_token_type</code> in the TraT token request to <code>urn:ietf:params:oauth:token-type:self_signed</code>. The self-signed JWTs must contain the following claims:</p>
<ul>
<li>
<p><strong>iss:</strong> The unique identifier of the requesting workload. Tratteria utilizes this value in determining the <code>req_wl</code> value in the issued TraT.</p>
</li>
<li>
<p><strong>sub:</strong> The subject for whom the TraT is being requested. Tratteria use this value for the <code>sub</code> value in the issued TraT.</p>
</li>
<li>
<p><strong>aud:</strong> The unique identifier of the Tratteria. Tratteria verifies that this value matches its configured <code>issuer</code> value.</p>
</li>
<li>
<p><strong>iat:</strong> The time at which the self-signed JWT was created.</p>
</li>
<li>
<p><strong>exp:</strong> The expiration time for the self-signed JWT.</p>
</li>
</ul>
<p>Additionally, the self-signed JWTs may contain other claims.</p>
<p>Tratteria extracts the <code>sub</code> claim of the self-signed JWTs into the <code>sub</code> claim of the issued TraT.</p>
<p>This is an optional configuration. When configured, it includes the following:</p>
<ul>
<li>
<p><strong>validation (Required)</strong><br>
Determines whether validation of the self-signed JWTs is enabled (<code>true</code>) or disabled (<code>false</code>). Ensure this is enabled in production settings.</p>
</li>
<li>
<p><strong>jwksEndpoint (Required)</strong><br>
The URL where the JSON Web Key Set (JWKS) can be found for validating self-signed JWTs signatures.</p>
</li>
</ul>
<p>Check the <a href="https://www.ietf.org/archive/id/draft-ietf-oauth-transaction-tokens-03.html#:~:text=7.2.1.-,Self%2DSigned%20Subject%20Token%20Type,-A%20requester%20MAY" target="_blank" rel="noopener">self-signed JWTs</a> in the TraT draft specification for more details.</p>
</li>
</ul>
<h5 id="accessevaluationapi-optional">
  accessEvaluationAPI (Optional)
  <a href="#accessevaluationapi-optional">
    <span class="icon hashlink">
      <i class="fas fa-link"></i>
    </span>
  </a>
</h5>
<p>Tratteria supports access evaluation of transactions before issuing TraTs. Tratteria supports <a href="https://openid.github.io/authzen/#name-access-evaluations-api" target="_blank" rel="noopener">AuthZen</a> access-evaluation API.</p>
<p>This is an optional configuration. When configured, it requires the following:</p>
<ul>
<li>
<p><strong>enableAccessEvaluation (Required)</strong>
Toggle to enable or disable access evaluation.</p>
</li>
<li>
<p><strong>endpoint (Required)</strong><br>
The URL of the access-evaluation API endpoint.</p>
</li>
<li>
<p><strong>authentication (Required)</strong><br>
The authentication method for the access-evaluation API. It includes the following:</p>
<ul>
<li>
<p><strong>method (Required)</strong><br>
The authentication method for the access-evaluation API. Currently, only <code>Bearer</code> token method is supported.</p>
</li>
<li>
<p><strong>token (Required)</strong><br>
Specifies the token to be used with the authentication method. Currently, only <code>value</code> is supported. For security reasons, it is recommended to set this via an environment variable.</p>
</li>
</ul>
</li>
<li>
<p><strong>requestMapping (Required)</strong><br>
Specifies how to construct the request body for the access-evaluation API using JSON path expressions and YAML fields. The configuration allows for the construction of arbitrary JSONs using TraTs request components: <code>subject_token</code>, <code>purp</code>, <code>request_details</code>, and <code>request_context</code>. If a particular JSON path does not exist for a request, the field is omitted.</p>
</li>
</ul>
<h5 id="tokengenerationauthorizedserviceids-required">
  tokenGenerationAuthorizedServiceIds (Required)
  <a href="#tokengenerationauthorizedserviceids-required">
    <span class="icon hashlink">
      <i class="fas fa-link"></i>
    </span>
  </a>
</h5>
<p>SPIFFE IDs of services authorized to request TraTs. This list should include the SPIFFE ID of the Gateway, API microservice, Load Balancer, or any other service that receives external API calls and generates the initial TraT.</p>
<h5 id="environment-variables">
  Environment Variables
  <a href="#environment-variables">
    <span class="icon hashlink">
      <i class="fas fa-link"></i>
    </span>
  </a>
</h5>
<p>Use environment variables to securely handle sensitive information, such as API tokens. These variables are automatically resolved during runtime at Tratteria service. Tratteria service reads the environment variables without writing them to the configuration file.</p>

</div>


        </section>
        <section class="col d-none d-lg-block">
          



  <div class="toc">
    <p> On this page:</p>
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>


        </section>

      </section>
    </div>

    </main>
    



<footer class="text-light bg-dark" style="padding: 20px 0; text-align: center;">
  <div class="footer">
    <p>Tratteria is an open-source project sponsored by <a href="https://www.sgnl.ai" target="_blank">SGNL.ai</a></p>
  </div>
  
  <div class="container">

    <div style="margin-bottom: 20px;">
      <i class="fab fa-github" style="font-size: 24px;"></i>
    </div>

    
    <div style="margin-bottom: 20px;">
      


<a class="btn text-light" style="background-color: #000000" href="https://github.com/tratteria">
    
    <span class="icon">
      <i class="fab fa-github"></i>
    </span>
    
    
      GitHub
    
  </a>


<a class="btn text-light" style="background-color: #555555" href="mailto:tratteria@sgnl.ai">
    
    <span class="icon">
      <i class="fas fa-paper-plane"></i>
    </span>
    
    
      Email
    
  </a>


    </div>
    

    <p style="margin-top: 20px;">
      &copy; 2024 SGNL.ai, Inc.
    </p>
  </div>
</footer>
  </body>
</html>
