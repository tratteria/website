
<!DOCTYPE html>
<html>
  <head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    
    <script async src="https://cse.google.com/cse.js?cx=315531be7c52f5156"></script>
    <title>
      
        Tratteria
      
    </title>
    <link rel="stylesheet" href="/css/style.1df9f62415d297f5c54d2fc02d71b1b122e108253802ae8fa49b752f0120f199.css" integrity="sha256-Hfn2JBXSl/XFTS/ALXGxsSLhCCU4Aq6PpJt1LwEg8Zk=">

    


<link rel="shortcut icon" href="/favicon.svg">


    
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
<script src="/js/app.09103495742f46957c0ccfe21325d1eb09374faea4d172abd0531e9d9fe6ea17.js" type="module" integrity="sha256-CRA0lXQvRpV8DM/iEyXR6wk3T66k0XKr0FMenZ/m6hc="></script>


  </head>

    <body>
      






<div class="navbar navbar-expand-lg navbar-light bg-light sticky-top" role="navigation" aria-label="main navigation">
  <div class="container nav-container">
    <div class="navbar-brand">
      <a class="navbar-item text-hide" href="https://tratteria.io/">
        Tratteria
        
        
          <img src="/img/logos/text-image-logo.svg" class="logo">
        
      </a>
    </div>

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main-nav" aria-controls="main-nav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="main-nav">
      <ul class="navbar-nav mr-auto">
        
        
        
        <li class="navbar-start navbar-item">
          
          <a class="nav-link" href="/">
            Home
          </a>
          
        
        <li class="navbar-start navbar-item">
          
          <a class="nav-link" href="/docs/">
            Documentation
          </a>
          
        </li>
        
      </ul>
      <div class="gcse-search"></div>
    </div>
  </div> 
</div>

    <main class="content">
      
  <header>
    <div>
      <div class="container mt-4 mb-4 pb-2">
  <section class="row">
      
          

<div class="col col-11 breadcrumb" aria-label="breadcrumbs">
  <ul class="mb-0 pt-2" style="vertical-align: middle">
    

  

  

  



<li >
  / <a href="/">
    Home
  </a>
</li>




<li >
  / <a href="/docs/">
    Introduction to Tratteria
  </a>
</li>




<li >
  / <a href="/docs/configuration-guide/">
    Configuration Guide
  </a>
</li>




<li  class="is-active">
  / <a href="/docs/configuration-guide/trat/">
    TraT
  </a>
</li>

  </ul>
</div>

          <div>
    
    
    
    <a href="https://github.com/tratteria/website/blob/main/content/docs/configuration-guide/trat.md" class="btn btn-primary" target="_blank">
      <i class="fas fa-pen"></i>
    </a>
</div>

      
  </section>
</section>
</div>

    </div>
  </header>
  <div class="container">
      <section class="row">        
        <section class="col">
           
 
 




<nav class="section-nav">
      <p class="menu-label open" id="leftnavToggle">Documentation:</p>      
      <ul class="menu-list" id="leftnav">
        <li><a  href="/docs/">Introduction to Tratteria</a>
        
        </li>
    
        <li><a  href="/docs/quickstart/">Quickstart Guide</a>
          <ul>
            
          </ul>
        </li>
    
        <li><a  href="/docs/installation/">Installing Tratteria</a>
          <ul>
            
            <li>
                <a  href="/docs/installation/installing-tconfigd/">Installing Tconfigd</a>
            </li>
            
            <li>
                <a  href="/docs/installation/deploying-tratteria/">Deploying Tratteria Service</a>
            </li>
            
            <li>
                <a  href="/docs/installation/setting-up-tratteria-agents/">Setting Up Tratteria Agents</a>
            </li>
            
          </ul>
        </li>
    
        <li><a  href="/docs/generating-and-verifying-trats/">Generating and Verifying TraTs</a>
          <ul>
            
          </ul>
        </li>
    
        <li><a  href="/docs/configuration-guide/">Configuration Guide</a>
          <ul>
            
            <li>
                <a  href="/docs/configuration-guide/trat/">TraT</a>
            </li>
            
            <li>
                <a  href="/docs/configuration-guide/trat-exclusion/">TraTExclusion</a>
            </li>
            
            <li>
                <a  href="/docs/configuration-guide/tratteria-config/">TratteriaConfig</a>
            </li>
            
            <li>
                <a  href="/docs/configuration-guide/example-application-configs/">Example Application Configurations</a>
            </li>
            
          </ul>
        </li>
    
        <li><a  href="/docs/transaction-token/">Transaction Tokens (TraTs)</a>
          <ul>
            
          </ul>
        </li>
    

</nav>

        </section>
        <section class="col col-8">
          <h1 class="title">TraT</h1>
          <p class="subtitle"></p>
          
<div class="content">
  <p>A TraT resource corresponds to a TraT type, defining a TraT for an external API. It defines how to generate the TraT for an external API and how to verify the TraT in the resulting internal requests. Additionally, it supports access evaluation for external APIs. A TraT resource comprises four sections: External API Specification, TraT Generation, TraT Verification, and Access Evaluation.</p>
<p>The external API specification section specifies the external API for which the TraT is defined. TraT generation section supports constructing the TraT using request URL parameters, headers, body, and literal constants. TraT verification section support listing the internal APIs that are invoked by the external API and rules to verify the TraT in them. And the access evaluation section supports specifying the rule to construct access evaluation request body for the external API.</p>
<p>Let&rsquo;s delve into the details of TraTs by examining an example.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">tratteria.io/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">TraT</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">order-trade-trat</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">alpha-stocks-dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">endpoint</span>: <span style="color:#e6db74">&#34;order/trade/{#stockId}?action={#action}&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">method</span>: <span style="color:#e6db74">&#34;POST&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">purp</span>: <span style="color:#ae81ff">trade</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">azdMapping</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">quantity</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">required</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;${body.quantity}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">action</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">required</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;${action}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">stockId</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">required</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;${stockId}&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">services</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">order</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">catalog</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">endpoint</span>: <span style="color:#e6db74">&#34;catalog/catalog-update/{#stockId}?update-type={#action}&#34;</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">stocks</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">endpoint</span>: <span style="color:#e6db74">&#34;stocks/?id={#id}&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">method</span>: <span style="color:#e6db74">&#34;GET&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">azdMapping</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">stockId</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">required</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;{$id}&#34;</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">payment</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">endpoint</span>: <span style="color:#e6db74">&#34;payment/trade?numbers={#numbers}&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">azdMapping</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">quantity</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">required</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;{$numbers}&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">accessEvaluation</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">subject</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">id</span>: <span style="color:#e6db74">&#34;${subject_token.email}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">action</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#34;${scope}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resource</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">stockId</span>: <span style="color:#e6db74">&#34;${stockId}&#34;</span>
</span></span></code></pre></div><p>Below are the four sections of the above TraT:</p>
<h4 id="external-api-specification-section">
  External API Specification Section
  <a href="#external-api-specification-section">
    <span class="icon hashlink">
      <i class="fas fa-link"></i>
    </span>
  </a>
</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">endpoint</span>: <span style="color:#e6db74">&#34;order/trade/{#stockId}?action={#action}&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">method</span>: <span style="color:#e6db74">&#34;POST&#34;</span>
</span></span></code></pre></div><p>The above configuration specifies the external API for which the <code>order-trade-trat</code> is defined. The endpoint supports the definition of variables that can be referenced later. A variable is defined by placing a name prefixed with a <code>#</code> inside the curly braces. In this endpoint, the <code>stockId</code> path parameter and <code>action</code> query parameter are defined.</p>
<h4 id="trat-generation-section">
  TraT Generation Section
  <a href="#trat-generation-section">
    <span class="icon hashlink">
      <i class="fas fa-link"></i>
    </span>
  </a>
</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">purp</span>: <span style="color:#ae81ff">trade</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">azdMapping</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">quantity</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">required</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;${body.quantity}&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">action</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">required</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;${action}&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">stock</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">required</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;${stockId}&#34;</span>
</span></span></code></pre></div><p>The above configuration specifies how to construct the TraT purpose and authorization details for the external API. It supports constructing them using the following parameters and their JSON path expressions:</p>
<ol>
<li>Request Body (referenced using <code>${body}</code>)</li>
<li>Request Header (referenced using <code>${header}</code>)</li>
<li>Variables defined in the API specification section (referenced using <code>${variable_name}</code>)</li>
<li>Literal string constants</li>
</ol>
<p>The above generation rule produces a TraT as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-plaintext" data-lang="plaintext"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    purp: &#34;trade&#34;,
</span></span><span style="display:flex;"><span>    adz: {
</span></span><span style="display:flex;"><span>        quantity: ...,
</span></span><span style="display:flex;"><span>        action: ...,
</span></span><span style="display:flex;"><span>        stock: ...,
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The <code>required</code> field in the <code>azdMapping</code> is used for TraT verification. If required is set to <code>true</code>, the field must be present in both the TraT and the request. If set to <code>false</code>, then the field is either not present in both the TraT and the request, or present in both. A TraT field being present only in the TraT or only in the request is never valid.</p>
<h4 id="trat-verification-section">
  TraT Verification Section
  <a href="#trat-verification-section">
    <span class="icon hashlink">
      <i class="fas fa-link"></i>
    </span>
  </a>
</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">order</span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">catalog</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">endpoint</span>: <span style="color:#e6db74">&#34;catalog/catalog-update/{#stockId}?update-type={#action}&#34;</span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">stocks</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">endpoint</span>: <span style="color:#e6db74">&#34;stocks/?id={#id}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">method</span>: <span style="color:#e6db74">&#34;GET&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">azdMapping</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">stockId</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">required</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;{$id}&#34;</span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">payment</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">endpoint</span>: <span style="color:#e6db74">&#34;payment/trade?numbers={#numbers}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">azdMapping</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">quantity</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">required</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;{$numbers}&#34;</span>
</span></span></code></pre></div><p>The above section lists the services and their APIs that are invoked while processing the <code>POST order/trade/{#stockId}?action={#action}</code> external API. For each service, the default <code>endpoint</code>, <code>method</code>, and <code>azdMapping</code> may be used or each field can be overridden with different values.</p>
<p>In the above, the <code>order</code>, <code>catalog</code>, <code>stocks</code>, and <code>payment</code> services&rsquo; endpoints are invoked when processing the external trade request.</p>
<p><strong>Order service</strong>: All <code>endpoint</code>, <code>method</code>, and <code>azdMapping</code> are inherited from the original definition.</p>
<p><strong>Catalog service</strong>: <code>azdMapping</code> is inherited from the original definition.</p>
<p><strong>Stocks service</strong>: None is inherited.</p>
<p><strong>Payment service</strong>: None is inherited.</p>
<h4 id="access-evaluation-section">
  Access Evaluation Section
  <a href="#access-evaluation-section">
    <span class="icon hashlink">
      <i class="fas fa-link"></i>
    </span>
  </a>
</h4>
<p>This section is optional. If access evaluation is enabled, then this section details how to construct the access evaluation request body for the external API.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">accessEvaluation</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">subject</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">id</span>: <span style="color:#e6db74">&#34;${subject_token.email}&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">action</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#34;${scope}&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">resource</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">stockId</span>: <span style="color:#e6db74">&#34;${stockId}&#34;</span>
</span></span></code></pre></div><p>This section supports referencing all default azdMapping references (<code>${body}</code>, <code>${header}</code>, and <code>${variable_name}</code>) as well as transaction-token request components (<code>grant_type</code>, <code>requested_token_type</code>, <code>audience</code>, <code>purpose</code>, <code>subject-token</code>, <code>subject-token-type</code>, <code>request-details</code>, and <code>request-context</code>).</p>
<p>The configuration above generates an access evaluation request body as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-plaintext" data-lang="plaintext"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    &#34;subject&#34;: {
</span></span><span style="display:flex;"><span>        &#34;id&#34;: ...
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    &#34;action&#34;: {
</span></span><span style="display:flex;"><span>        &#34;name&#34;: ...
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    &#34;resource&#34;: {
</span></span><span style="display:flex;"><span>        &#34;stockId&#34;: ...
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>
</div>


        </section>
        <section class="col d-none d-lg-block">
          



  <div class="toc">
    <p> On this page:</p>
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>


        </section>

      </section>
    </div>

    </main>
    



<footer class="text-light bg-dark" style="padding: 20px 0; text-align: center;">
  <div class="footer">
    <p>Tratteria is an open-source project sponsored by <a href="https://www.sgnl.ai" target="_blank">SGNL.ai</a></p>
  </div>
  
  <div class="container">

    <div style="margin-bottom: 20px;">
      <i class="fab fa-github" style="font-size: 24px;"></i>
    </div>

    
    <div style="margin-bottom: 20px;">
      


<a class="btn text-light" style="background-color: #000000" href="https://github.com/tratteria">
    
    <span class="icon">
      <i class="fab fa-github"></i>
    </span>
    
    
      GitHub
    
  </a>


    </div>
    

    <p style="margin-top: 20px;">
      &copy; 2024 SGNL.ai, Inc.
    </p>
  </div>
</footer>
  </body>
</html>
